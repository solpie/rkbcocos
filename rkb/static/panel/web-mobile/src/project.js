window.__require=function t(e,o,r){function c(i,s){if(!o[i]){if(!e[i]){var _=i.split("/");if(_=_[_.length-1],!e[_]){var a="function"==typeof __require&&__require;if(!s&&a)return a(_,!0);if(n)return n(_,!0);throw new Error("Cannot find module '"+i+"'")}}var l=o[i]={exports:{}};e[i][0].call(l.exports,function(t){return c(e[i][1][t]||t)},l,l.exports,t,e,o,r)}return o[i].exports}for(var n="function"==typeof __require&&__require,i=0;i<r.length;i++)c(r[i]);return c}({JsFunc:[function(t,e,o){"use strict";cc._RF.push(e,"53647ot8ylLHbVShzWNcLoS","JsFunc"),Object.defineProperty(o,"__esModule",{value:!0}),o.formatSecond=function(t,e,o,r){void 0===e&&(e=!1),void 0===o&&(o=":"),void 0===r&&(r="");var c=Math.floor(t/60),n=t%60,i=c+"",s=n+"";return c<10&&(i="0"+i),n<10&&(s="0"+s),e?s:i+o+s+r},cc._RF.pop()},{}],__clip:[function(t,e,o){"use strict";cc._RF.push(e,"45636nxzW9CbZJzzJEKtkem","__clip"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.start=function(){this.getComponent(cc.Animation).play("player_dot"),cc.log("on start")},e=__decorate([r],e)}(cc.Component);o.default=c,cc._RF.pop()},{}],__c:[function(t,e,o){"use strict";cc._RF.push(e,"f631evoBMdDiK7w/lLKMsw9","__c"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,c=r.ccclass,n=r.property;o.setText=function(t,e){_c_.emit(o.ccType.Label,{name:t,string:e})},o.ccType={Sprite:"Sprite",Label:"Label",Animation:"Animation",ProgressBar:"ProgressBar"};var i={Sprite:cc.Sprite,Label:cc.Label,Animation:cc.Animation,ProgressBar:cc.ProgressBar},s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cc_type="",e}return __extends(e,t),e.prototype.onLoad=function(){var t=this;if(this.cc_type)cc.log("speci type",this.cc_type,this.node._components[0]),this.cls=this.cc_type,this.comp=this.node.getComponent(i[this.cls]);else for(var e in i){var r=i[e],c=this.node._components[0];if(c instanceof r){this.comp=c,this.cls=e;break}}this._name=this.node.getComponent(i[this.cls]).node.name,cc.log(this._name,"is",this.cls);var n=function(e,o){t.cls==e&&_c_.on(e,function(e){e.name==t._name&&o(e)})};n(o.ccType.Sprite,function(e){var o=t.comp;e.img64&&function(t,e){var o=new Image;o.src=e;var r=new cc.Texture2D;r.initWithElement(o),r.handleLoadedTexture();var c=new cc.SpriteFrame(r);t.spriteFrame=c}(o,e.img64);cc.log("handle sprite",t._name,e.x);for(var r=0,c=["x","y","opacity","callback"];r<c.length;r++){var n=c[r];null!=e[n]&&("callback"==n?e[n](t.node):t.node[n]=e[n])}}),n(o.ccType.Label,function(e){var o=t.comp;for(var r in e)"name"!=r&&null!=o[r]&&(o[r]=e[r])}),n(o.ccType.Animation,function(e){var o=t.comp;e.play&&o.play(e.play)}),n(o.ccType.ProgressBar,function(e){var o=t.comp;if(null!=e.progress){o.progress=e.progress;for(var r=0;r<e.callbackMap.length;r++){var c=e.callbackMap[r],n=c[0];if(o.progress>=n){c[1](t.node);break}}}})},__decorate([n],e.prototype,"cc_type",void 0),e=__decorate([c],e)}(cc.Component);o.default=s,cc._RF.pop()},{}],api:[function(t,e,o){"use strict";for(var r in cc._RF.push(e,"97b19fYMMNLcJlnoH9VSXld","api"),Object.defineProperty(o,"__esModule",{value:!0}),o.conf={localWS:"/rkb"},o.WSEvent={sc_ww3_team_score:"",sc_teamScore:"",sc_timerEvent:"",sc_setFoul:"",sc_setBlood:"",sc_setPlayer:"",sc_setPlayerDot:""},o.WSEvent)o.WSEvent[r]=r;cc._RF.pop()},{}],bloodBar:[function(t,e,o){"use strict";cc._RF.push(e,"e76bfaGNZZHOKmqElYwya+a","bloodBar"),Object.defineProperty(o,"__esModule",{value:!0});var r=t("../__c"),c=t("./worldwar3"),n=t("../com/gameConf"),i=function(){function t(t){this.maxBlood=n.confWW3.maxBlood,this._tmpBlood=-1,this._curBlood=-1,this._fx_offs=null,this._fx_cd=1500,this._fx_cd_timer=null,this.cur_fx_offs=-1,this._isR=t,this._bloodTxt=t?c._nm_.txt_blood_R:c._nm_.txt_blood_L,this._bloodCursor=t?"blood_bar_cursor_R":"blood_bar_cursor_L",this._bloodFx=t?"blood_bar_black_R":"blood_bar_black_L"}return t.prototype.setBlood=function(t){this.initBlood=t;var e=this._setBlood(t);this.bloodNoTween(e)},t.prototype.reset=function(){this.setBlood(n.confWW3.maxBlood)},t.prototype._setBlood=function(t){var e=this._isR?-1:1,o=this._bloodCursor,c=1-t/this.maxBlood;r.setText(this._bloodTxt,t);var n=(-495- -395*c)*e;return _c_.emit(r.ccType.Sprite,{name:o,x:n}),n},t.prototype.bloodTween=function(t){cc.log("play blood fx...",this._fx_offs),this.cur_fx_offs=this._fx_offs,cc.tween(t).to(.3,{x:this._fx_offs}).start()},t.prototype.bloodNoTween=function(t){_c_.emit(r.ccType.Sprite,{name:this._bloodFx,x:t})},t.prototype.setBloodByDtScore=function(t){var e=this,o=this.initBlood-t;this._curBlood=o;var c,n=this._setBlood(o);if(null!=this._fx_offs&&(c=this._isR?n>this._fx_offs:n<this._fx_offs)&&cc.log("\u52a0\u8840"),this._fx_offs=n,c)this.bloodNoTween(n);else if(t>=0){this._tmpBlood<0&&(this._tmpBlood=o);if(this._fx_cd_timer)this._fx_cd=800;else{this._fx_cd=800;new cc.Scheduler;this._fx_cd_timer=setInterval(function(){e._fx_cd-=10,e._fx_cd<=0&&(_c_.emit(r.ccType.Sprite,{name:e._bloodFx,callback:function(t){e.bloodTween(t)}}),clearInterval(e._fx_cd_timer),e._fx_cd_timer=null)},10)}}return o},t}();o.BloodBar=i,cc._RF.pop()},{"../__c":"__c","../com/gameConf":"gameConf","./worldwar3":"worldwar3"}],gameConf:[function(t,e,o){"use strict";cc._RF.push(e,"7c037x9WaBHioJ2UqJp0as0","gameConf"),Object.defineProperty(o,"__esModule",{value:!0}),o.confWW3={maxBlood:9,foulToHint:3,time:1200},cc._RF.pop()},{}],labelShadow:[function(t,e,o){"use strict";cc._RF.push(e,"645a98RIXlFqLN3zHaeY4WF","labelShadow"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,c=r.ccclass,n=r.property,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.text="hello",e}return __extends(e,t),e.prototype.start=function(){this.node.getComponent(cc.Label)},e.prototype.update=function(){this.label.string=this.text},__decorate([n(cc.Label)],e.prototype,"label",void 0),__decorate([n],e.prototype,"text",void 0),e=__decorate([c],e)}(cc.Component);o.default=i,cc._RF.pop()},{}],main:[function(t,e,o){"use strict";cc._RF.push(e,"120adAfDgdOtZPy4v1kF4CF","main"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,c=r.ccclass,n=(r.property,{ww3:"worldwar3",bblood:"bblood"});window._c_=new cc.Node("_c_");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){var t=new URLSearchParams(window.location.search).get("panel");if(t){for(var e in n)if(t==e){var o=n[e];cc.director.loadScene(o)}}else 0},e.prototype.start=function(){},e=__decorate([c],e)}(cc.Component);o.default=i,cc._RF.pop()},{}],timer:[function(t,e,o){"use strict";cc._RF.push(e,"b9fb7MYUuxMiaVk49oMgwiX","timer"),Object.defineProperty(o,"__esModule",{value:!0});var r,c=t("../__c"),n=t("./JsFunc");o.TimerEvent={START:"start",PAUSE:"pause",TOGGLE:"toggle",SHIFT:"shift",RESET:"reset",SETTING:"setting"},o.TimerState={START_STR:"start",PAUSE_STR:"pause",PAUSE:0,RUNNING:1};var i=function(){function t(){this.timeInSec=1200,this.resetTime=0,this.isSecOnly=!1,this.isMin=!1}return t.prototype.initTimer=function(t,e){this._component=t,this._textName=e,this.resetTimer()},t.prototype.onTick=function(){this.isMin?this.timeInSec--:this.timeInSec++,c.setText(this._textName,n.formatSecond(this.timeInSec))},t.prototype.startTimer=function(){var t=this;r||(r=function(){t.onTick()},this._component.schedule(r,1,1/0))},t.prototype.pauseTimer=function(){r&&(this._component.unschedule(r),r=null)},t.prototype.setTimeBySec=function(t){this.timeInSec=t,c.setText(this._textName,n.formatSecond(this.timeInSec,this.isSecOnly))},t.prototype.resetTimer=function(){this.timerState=o.TimerState.PAUSE,this.setTimeBySec(this.resetTime)},t.prototype.setTimerEvent=function(t){t.event==o.TimerEvent.PAUSE?this.pauseTimer():t.event==o.TimerEvent.START?this.startTimer():t.event==o.TimerEvent.RESET?(this.toggleTimer(o.TimerEvent.RESET),this.resetTimer()):t.event==o.TimerEvent.SETTING?this.setTimeBySec(t.param):t.event==o.TimerEvent.SHIFT?this.setTimeBySec(this.timeInSec+t.param):t.event==o.TimerEvent.TOGGLE&&this.toggleTimer()},t.prototype.toggleTimer=function(t){r?this.pauseTimer():this.startTimer()},t}();o.Timer=i,cc._RF.pop()},{"../__c":"__c","./JsFunc":"JsFunc"}],web:[function(t,e,o){"use strict";cc._RF.push(e,"fe7e54cytVMp4QLjboCqLbl","web"),Object.defineProperty(o,"__esModule",{value:!0});var r=t("./__c");o.loadImg64=function(t,e){var o=function(t){return"/proxy?url="+t}(e);axios.get(o).then(function(e){_c_.emit(r.ccType.Sprite,{name:t,img64:e.data})})},cc._RF.pop()},{"./__c":"__c"}],worldwar3_test:[function(t,e,o){"use strict";cc._RF.push(e,"e080bKA8xJMao2Hn7ZsbbKj","worldwar3_test"),cc._RF.pop()},{}],worldwar3:[function(t,e,o){"use strict";cc._RF.push(e,"e1b90/rohdEk4SdmmEZANaD","worldwar3"),Object.defineProperty(o,"__esModule",{value:!0});var r=t("../api"),c=t("../__c"),n=t("./../__c"),i=t("../web"),s=t("../com/timer"),_=t("./bloodBar"),a=cc._decorator.ccclass;o._nm_={txt_team_score:"txt_team_score",txt_team_left:"txt_team_left",txt_team_right:"txt_team_right",txt_player_left:"txt_player_left",txt_player_right:"txt_player_right",txt_blood_L:"txt_blood_L",txt_blood_R:"txt_blood_R",txt_foul_L:"txt_foul_L",txt_foul_R:"txt_foul_R",sp_avt_L:"avt_L",sp_avt_R:"avt_R"};var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.gameTimer=new s.Timer,e.foulToFT=5,e}return __extends(e,t),e.prototype.onLoad=function(){console.log("onLoad Worldwar3"),this.gameTimer.initTimer(this,"txt_timer")},e.prototype.start=function(){console.log("start worldwar3"),this.gameTimer.isMin=!1,this.gameTimer.resetTimer(),this.bloodBar_L=new _.BloodBar(0),this.bloodBar_R=new _.BloodBar(1),this.bloodBar_L.reset(),this.bloodBar_R.reset(),this.setFoul_L(0),this.setFoul_R(0),this.initWS()},e.prototype.test=function(){var t=this;setTimeout(function(){i.loadImg64(o._nm_.sp_avt_L,"http://rtmp.icassi.us:8092/img/player/0323/p1.png"),c.setText(o._nm_.txt_team_score,"0 - 0"),c.setText(o._nm_.txt_blood_L,"2"),c.setText(o._nm_.txt_player_right,"\u9a6c\u514b"),t.setPlayerDot(1,3,!1),t.setPlayerDot(0,3,!0)},2e3)},e.prototype.setPlayerDot=function(t,e,o){var r="player_dot_off_"+(t?"R":"L"),c=this.foulToFT,i=o?"player_dot_on":"player_dot_off";function s(t,e){var o=r+e;setTimeout(function(){_c_.emit(n.ccType.Animation,{name:o,play:i})},t)}for(var _=0;_<c-e;_++){s(250*_,o?c-_:_+1)}},e.prototype.testPlayerDot=function(){var t=this;function e(t,e){setTimeout(function(){c.setText(o._nm_.txt_blood_L,e),c.setText(o._nm_.txt_blood_R,e)},t)}cc.log("testPlayerDot.."),this.setPlayerDot(1,2,!1);for(var r=0;r<11;r++)e(80*r,r);this.bloodBar_L.setBlood(9),this.bloodBar_R.setBlood(8);var n=function(e,o){setTimeout(function(){t.setFoul_L(o),t.setFoul_R(o),t.bloodBar_L.setBloodByDtScore(5),t.bloodBar_R.setBloodByDtScore(1)},e)};for(r=0;r<6;r++)n(280*r,r)},e.prototype.setFoul_L=function(t,e){e&&(this.foulToFT=e),c.setText(o._nm_.txt_foul_L,t);var r=t/this.foulToFT;this.setFoulBar(!1,r)},e.prototype.setFoul_R=function(t,e){e&&(this.foulToFT=e),c.setText(o._nm_.txt_foul_R,t);var r=t/this.foulToFT;this.setFoulBar(!0,r)},e.prototype.setFoulBar=function(t,e){var o=t?"foulBar_R":"foulBar_L";cc.log("setFoulBar",o,e),_c_.emit(n.ccType.ProgressBar,{name:o,progress:e,callbackMap:[[1,function(t){cc.log("on progress",t),t.getComponent(cc.Animation).play("foul_bar_max")}],[0,function(t){cc.log("on progress",t);var e=t.getComponent(cc.Animation);e.stop("foul_bar_max"),e.play("foul_bar_normal")}]]})},e.prototype.setPlayer=function(t,e){var r=t?o._nm_.txt_player_right:o._nm_.txt_player_left;if(c.setText(r,e.name),e.avatar){var n=t?o._nm_.sp_avt_R:o._nm_.sp_avt_L;i.loadImg64(n,e.avatar)}null!=e.blood&&(t?this.bloodBar_R:this.bloodBar_L).setBlood(e.blood)},e.prototype.initWS=function(){var t=this,e=r.conf.localWS;io(e).on("connect",function(t){cc.log("socketio.....localWS")}).on(r.WSEvent.sc_teamScore,function(t){cc.log("sc_teamScore",t),c.setText(o._nm_.txt_team_score,t.lScore+" - "+t.rScore)}).on(r.WSEvent.sc_timerEvent,function(e){cc.log("sc_timerEvent",e),t.gameTimer.setTimerEvent(e)}).on(r.WSEvent.sc_setFoul,function(e){cc.log("sc_setFoul",e),t.setFoul_L(e.lFoul),t.setFoul_R(e.rFoul)}).on(r.WSEvent.sc_setBlood,function(e){cc.log("sc_setBlood",e),(!e.isLeft?t.bloodBar_L:t.bloodBar_R).setBloodByDtScore(e.score)}).on(r.WSEvent.sc_setPlayer,function(e){cc.log("sc_setPlayer",e),t.setPlayer(0,e.leftPlayer),t.setPlayer(1,e.rightPlayer),e.isRestFoul&&(t.setFoul_L(0),t.setFoul_R(0))}).on(r.WSEvent.sc_setPlayerDot,function(e){cc.log("sc_setPlayerDot",e),t.setPlayerDot(e.isR,e.count,!1)})},e=__decorate([a],e)}(cc.Component);o.default=l,cc._RF.pop()},{"../__c":"__c","../api":"api","../com/timer":"timer","../web":"web","./../__c":"__c","./bloodBar":"bloodBar"}]},{},["__c","__clip","api","JsFunc","gameConf","timer","labelShadow","bloodBar","main","worldwar3","worldwar3_test","web"]);